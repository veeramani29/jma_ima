CKEDITOR.plugins.add("inlinesave",{init:function(a){a.addCommand("inlinesave",{exec:function(e){var c=e.config.inlinesave,b={},h="",i="application/x-www-form-urlencoded; charset=UTF-8";if(typeof c=="undefined"){throw new Error("CKEditor inlinesave: You must define config.inlinesave in your configuration file. See http://ckeditor.com/addon/inlinesave");return}if(typeof c.postUrl=="undefined"){throw new Error("CKEditor inlinesave: You must define config.inlinesave.postUrl in your configuration file. See http://ckeditor.com/addon/inlinesave");return}if(typeof c.onSave=="function"){c.onSave(e)}CKEDITOR.tools.extend(b,c.postData||{},true);b.editabledata=e.getData();b.editorID=e.container.getId();if(!!c.useJSON){h=JSON.stringify(b);i="application/json; charset=UTF-8"}else{var g="";for(var d in b){g+="&"+d+"="+encodeURIComponent(b[d])}h=g.slice(1)}var f=new XMLHttpRequest();f.onreadystatechange=function(){if(f.readyState==4){if(typeof c.onSuccess=="function"&&f.status==200){c.onSuccess(e,f.response)}else{if(typeof c.onFailure=="function"){c.onFailure(e,f.status,f)}}}};f.open("POST",c.postUrl,true);f.setRequestHeader("Content-type",i);f.send(h)}});a.ui.addButton("Inlinesave",{label:"Save",command:"inlinesave",icon:this.path+"images/inlinesave.svg"})}});
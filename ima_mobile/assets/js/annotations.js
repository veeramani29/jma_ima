!function(t){"object"==typeof module&&module.exports?module.exports=t:t(Highcharts)}(function(t){"use strict";function n(t){var n,e;return e={xAxis:0,yAxis:0,shape:{params:{stroke:"#000000",fill:"rgba(0,0,0,0)","stroke-width":2}},selectionMarker:{"stroke-width":1,stroke:"black",fill:"transparent",dashstyle:"ShortDash","shape-rendering":"crispEdges"}},(n={circle:{params:{x:0,y:0}}})[t]&&(e.shape=g(e.shape,n[t])),e}function e(){var t=[],n=["circle","line","square","text"],e=["circle","path","rect",null],o=[{r:0,fill:"transparent",stroke:"gray"},{d:["M",0,0,"L",10,10],fill:"transparent",stroke:"gray"},{width:10,height:10,fill:"transparent",stroke:"gray"}],a=[V.getRadius,V.getPath,V.getRect,V.getText],i=[V.getRadiusAndUpdate,V.getPathAndUpdate,V.getRectAndUpdate,V.showInput];return v(n,function(n,s){t.push({annotationEvents:{step:a[s],stop:i[s]},annotation:{anchorX:"left",anchorY:"top",xAxis:0,yAxis:0,shape:{type:e[s],params:o[s]},events:{dblclick:function(){this.destroy()}}},symbol:{shape:n,size:12,style:{"stroke-width":1,stroke:"text"==n?"black":"#6688aa",fill:"#e7f0f9",zIndex:121}},style:{fill:"black",stroke:"blue",strokeWidth:.5},size:12,states:{selected:{fill:"#9BD"},hover:{fill:"#9BD"}}})}),{enabledButtons:!1,buttons:t,buttonsOffsets:[0,-30]}}function o(t){return"[object Array]"===Object.prototype.toString.call(t)}function a(t){return"number"==typeof t}function i(t){return t!==d&&null!==t}function s(t,n,e,o,a){for(var i=t.length,s=0,r=[];s<i;)"number"==typeof t[s]&&"number"==typeof t[s+1]?(r[s]=n.toPixels(t[s])-o,r[s+1]=e.toPixels(t[s+1])-a,s+=2):(r[s]=t[s],s+=1);return r}function r(t,n,e){var o=t.renderer.g("annotations-group-"+n);return o.attr({zIndex:7}),o.add(),o.clip(e),o}function l(t,n){var e={x:n.left,y:n.top,width:n.width,height:n.height};return t.renderer.clipRect(e)}function u(t){function n(n){var e=t.annotations.selected;t.annotations.options.buttons[e].annotationEvents.step.call(t.drawAnnotation,n)}b(t.container,"mousedown",function(e){var o=t.container.getBoundingClientRect(),a=e.clientX-o.left,i=e.clientY-o.top;if(t.isInsidePlot(a-t.plotLeft,i-t.plotTop)&&!t.annotations.allowZoom){var s=t.xAxis[0],r=t.yAxis[0],l=t.annotations.selected,u=g(t.annotations.options.buttons[l].annotation,{xValue:s.toValue(a),yValue:r.toValue(i),allowDragX:!0,allowDragY:!0});t.addAnnotation(u),t.drawAnnotation=t.annotations.allItems[t.annotations.allItems.length-1],b(document,"mousemove",n)}}),b(document,"mouseup",function(e){if(m(document,"mousemove",n),t.drawAnnotation){var o=t.annotations.selected;t.annotations.options.buttons[o].annotationEvents.stop.call(t.drawAnnotation,e),t.annotations.allowZoom=!0,t.annotations.selected=-1,$("ul.list_annotations li").removeClass("select")}t.drawAnnotation=null})}function p(t,n){return function(){var e=n.annotations.buttons[t][0];2===e.state?(n.annotations.selected=-1,n.annotations.allowZoom=!0,e.setState(0)):(n.annotations.selected>=0&&n.annotations.buttons[n.annotations.selected][0].setState(0),n.annotations.allowZoom=!1,n.annotations.selected=t,e.setState(2))}}function c(t,n,e){var o,a,i=t.annotations.options.buttonsOffsets,s=t.rangeSelector&&t.rangeSelector.inputGroup?t.rangeSelector.inputGroup.offset:0,r=t.renderer,l=n.symbol,u=l.size,c=n.size-4,h=t.plotWidth+t.plotLeft-30*(e+1)-s-i[0],d=t.plotTop-(t.rangeSelector?23+c+4:0)+i[1],x=n.events&&n.events.click?n.events.click:p(e,t),f=n.states.selected,y=n.states.hover;return o=r.button("",h,d,x,{},y,f).attr({width:c,height:c,zIndex:10}),a=r.symbol(l.shape,c-u/2+4,c-u/2+4,u,u).attr(l.style).add(o),o.attr(o.style).add(),[o,a]}function h(t){var n=t.annotations.options.buttons;t.annotations.buttons=t.annotations.buttons||[],v(n,function(n,e){t.annotations.buttons.push(c(t,n,e))})}var d,x,f=t.Chart,y=t.extend,g=t.merge,v=t.each,A=window.HighchartsAdapter&&window.HighchartsAdapter.inArray||t.inArray,b=t.addEvent,m=t.removeEvent,w=!!t.VMLRenderer;t.ALLOWED_SHAPES=["path","rect","circle"],x={top:0,left:0,center:.5,middle:.5,bottom:1,right:1},t.SVGRenderer.prototype.symbols.line=function(t,n,e,o){return["M",t+2,n+2,"L",t+e-2,n+o-2]},t.SVGRenderer.prototype.symbols.text=function(t,n,e,o){return["M",t,n+1,"L",t+e,n+1,"M",t+e/2,n+1,"L",t+e/2,n+1+o]},t.VMLRenderer&&(t.VMLRenderer.prototype.symbols.text=t.SVGRenderer.prototype.symbols.text,t.VMLRenderer.prototype.symbols.line=t.SVGRenderer.prototype.symbols.line),t.wrap(t.Pointer.prototype,"drag",function(t,n){this.chart.annotations&&!this.chart.annotations.allowZoom||t.call(this,n)}),t.wrap(t.Pointer.prototype,"onContainerMouseDown",function(t,n){t.call(this,n),this.chart.selectedAnnotation&&this.chart.selectedAnnotation.events.deselect.call(this.chart.selectedAnnotation,n)});var V={getRadius:function(t){var n=this,e=n.chart,o=e.container.getBoundingClientRect(),a=t.clientX-o.left,i=t.clientY-o.top,s=e.xAxis[n.options.xAxis],r=e.yAxis[n.options.yAxis],l=Math.abs(a-s.toPixels(n.options.xValue)),u=Math.abs(i-r.toPixels(n.options.yValue)),p=parseInt(Math.sqrt(l*l+u*u),10);return n.shape.attr({r:p}),p},getRadiusAndUpdate:function(t){var n=V.getRadius.call(this,t);this.update({shape:{params:{r:n,x:-n,y:-n}}})},getPath:function(t){var n=this,e=n.chart,o=e.container.getBoundingClientRect(),a=t.clientX-o.left,i=t.clientY-o.top,s=e.xAxis[n.options.xAxis],r=e.yAxis[n.options.yAxis],l=a-s.toPixels(n.options.xValue),u=i-r.toPixels(n.options.yValue),p=["M",0,0,"L",parseInt(l,10),parseInt(u,10)];return n.shape.attr({d:p}),p},getPathAndUpdate:function(t){var n=this,e=n.chart,o=V.getPath.call(n,t),a=e.xAxis[n.options.xAxis],i=e.yAxis[n.options.yAxis],s=a.toValue(o[4]+a.toPixels(n.options.xValue)),r=i.toValue(o[5]+i.toPixels(n.options.yValue));this.update({xValueEnd:s,yValueEnd:r,shape:{params:{d:o}}})},getRect:function(t){var n=this,e=n.chart,o=e.container.getBoundingClientRect(),a=t.clientX-o.left,i=t.clientY-o.top,s=e.xAxis[n.options.xAxis],r=e.yAxis[n.options.yAxis],l=a-s.toPixels(n.options.xValue),u=i-r.toPixels(n.options.yValue),p=Math.round(l)+1,c=Math.round(u)+1,h={};return h.x=p<0?p:0,h.width=Math.abs(p),h.y=c<0?c:0,h.height=Math.abs(c),n.shape.attr({x:h.x,y:h.y,width:h.width,height:h.height}),h},getRectAndUpdate:function(t){var n=V.getRect.call(this,t);this.update({shape:{params:n}})},getText:function(){},showInput:function(t){var n=this,e=n.chart,o=e.annotationInputIndex=e.annotationInputIndex?e.annotationInputIndex:1,a=document.createElement("span");a.innerHTML='<input type="text" class="annotation-'+o+'" placeholder="Add text"><button class="annotation"> Done </button>',a.style.position="absolute",a.style.zIndex="2",a.style.left=t.pageX+"px",a.style.top=t.pageY+"px",document.body.appendChild(a),a.querySelectorAll("input")[0].focus(),a.querySelectorAll("button")[0].onclick=function(){var t=this.parentNode;n.update({title:{text:t.querySelectorAll("input")[0].value}}),t.parentNode.removeChild(t),$("body").on("click",function(t){if($(t.target).hasClass("annotation")){var n=e.renderTo.attributes[2].value;$("#Chart_Dv_placeholder_"+n).find("ul.list_annotations").addClass("open"),$("#Chart_Dv_placeholder_"+n).find("ul.list_annotations").show(),t.stopPropagation()}})},e.annotationInputIndex++}},P=function(){this.init.apply(this,arguments)};P.prototype={init:function(t,e){var o=e.shape&&e.shape.type;this.chart=t,this.options=g({},n(o),e),this.userOptions=e},render:function(n){function e(t,n){if(i(n))for(var e in n)!function(e){b(t.element,e,function(t){n[e].call(o,t)})}(e)}var o=this,a=this.chart,s=o.chart.renderer,r=o.group,l=o.title,u=o.shape,p=o.options,c=p.title,h=p.shape,d=p.allowDragX,x=p.allowDragY,f=o.hasEvents;r||(r=o.group=s.g()).attr({class:"highcharts-annotation"}),!u&&h&&-1!==A(h.type,t.ALLOWED_SHAPES)&&(u=o.shape="rect"===h.type?s[p.shape.type]().attr(h.params):s[p.shape.type](h.params)).add(r),!l&&c&&(l=o.title=s.label(c)).add(r),!d&&!x||f?f||($(r.element).on("mousedown",function(t){o.events.select(t,o)}),e(r,p.events)):($(r.element).on("mousedown",function(t){o.events.storeAnnotation(t,o,a),o.events.select(t,o)}),b(document,"mouseup",function(t){o.events.releaseAnnotation(t,a)}),e(r,p.events)),this.hasEvents=!0,r.add(a.annotations.groups[p.yAxis]),o.linkObjects(),!1!==n&&o.redraw()},redraw:function(n){var e,o,r,l,u,p,c=this.options,h=this.chart,d=this.group,f=this.title,g=this.shape,v=this.linkedObject,A=h.xAxis[c.xAxis],b=h.yAxis[c.yAxis],m=c.width,V=c.height,P=x[c.anchorY],k=x[c.anchorX];if(v&&("point"===(o=v instanceof t.Point?"point":v instanceof t.Series?"series":null)?(c.x=v.plotX+h.plotLeft,c.y=v.plotY+h.plotTop,r=v.series):"series"===o&&(r=v),r.pointXOffset&&(c.x+=r.pointXOffset+(v.shapeArgs.width/2||0)),d.attr({visibility:r.group.attr("visibility")})),u=i(c.xValue)?A.toPixels(c.xValue):c.x,p=i(c.yValue)?b.toPixels(c.yValue):c.y,h.inverted&&i(c.xValue)&&i(c.yValue)){var M=u;u=p,p=M}if(!isNaN(u)&&!isNaN(p)&&a(u)&&a(p)){if(f){var E=c.title;w?f.attr({text:E.text}):f.attr(E),f.css(c.title.style)}if(g){if(e=y({},c.shape.params),"values"===c.shape.units){var I=h.inverted?b:A,X=h.inverted?A:b;i(e.x)&&e.width?(e.width=A.toPixels(e.width+e.x)-A.toPixels(e.x),e.x=A.toPixels(e.x)):e.width?e.width=I.toPixels(e.width)-I.toPixels(0):i(e.x)&&(e.x=A.toPixels(e.x)),i(e.y)&&e.height?(e.height=-b.toPixels(e.height+e.y)+b.toPixels(e.y),e.y=b.toPixels(e.y)):e.height?(e.height=-X.toPixels(e.height)+X.toPixels(0),e.height*=h.inverted?-1:1):i(e.y)&&(e.y=b.toPixels(e.y)),"path"===c.shape.type&&(e.d=s(e.d,A,b,u,p))}i(c.yValueEnd)&&i(c.xValueEnd)&&(e.d=e.d||c.shape.d||["M",0,0,"L",0,0],e.d[4]=A.toPixels(c.xValueEnd)-A.toPixels(c.xValue),e.d[5]=b.toPixels(c.yValueEnd)-b.toPixels(c.yValue)),"circle"===c.shape.type&&(e.x+=e.r,e.y+=e.r),g.attr(e)}d.bBox=null,a(m)||(m=(l=d.getBBox()).width),a(V)||(l||(l=d.getBBox()),V=l.height),a(k)||(k=x.center),a(P)||(P=x.center),u-=m*k,p-=V*P,this.selectionMarker&&this.events.select({},this),n&&h.animation&&i(d.translateX)&&i(d.translateY)?d.animate({translateX:u,translateY:p}):d.translate(u,p)}},destroy:function(){var t=this,n=this.chart,e=n.annotations.allItems,o=e.indexOf(t);n.activeAnnotation=null,o>-1&&(e.splice(o,1),n.options.annotations.splice(o,1)),v(["title","shape","group"],function(n){t[n]&&t[n].destroy?(t[n].destroy(),t[n]=null):t[n]&&(t[n].remove(),t[n]=null)}),t.group=t.title=t.shape=t.chart=t.options=t.hasEvents=null},show:function(){this.linkedObject||(this.visible=!0,this.group.attr({visibility:"visible"}))},hide:function(){this.linkedObject||(this.visible=!1,this.group.attr({visibility:"hidden"}))},update:function(t,n){var e=this,o=this.chart,a=o.annotations.allItems.indexOf(e),i=g(this.options,t);return a>=0&&(o.options.annotations[a]=i),this.options=i,this.linkObjects(),this.render(n),this},select:function(){return this.events.select(null,this),this},deselect:function(){return this.events.deselect(null,this),this},linkObjects:function(){var t=this,n=t.chart,e=t.linkedObject,o=e&&(e.id||e.options.id),a=t.options.linkedTo;i(a)?i(e)&&a===o||(t.linkedObject=n.get(a)):t.linkedObject=null},events:{select:function(t,n){var e,o=n.chart,a=o.selectedAnnotation;a&&a!==n&&a.deselect(),n.selectionMarker||(e=n.group.getBBox(),n.selectionMarker=o.renderer.rect(e.x-5,e.y-5,e.width+10,e.height+10).attr(n.options.selectionMarker),n.selectionMarker.add(n.group)),o.selectedAnnotation=n},deselect:function(){this.selectionMarker&&this.group&&(this.selectionMarker.destroy(),this.selectionMarker=!1,this.group.bBox=null)},destroyAnnotation:function(t,n){n.destroy()},translateAnnotation:function(t,n){if(t.stopPropagation(),t.preventDefault(),n.activeAnnotation){var e=n.container.getBoundingClientRect(),o=t.clientX-e.left,a=t.clientY-e.top;if(!n.isInsidePlot(o-n.plotLeft,a-n.plotTop))return;var i=n.activeAnnotation,s=i.options.allowDragX?t.clientX-i.startX+i.group.translateX:i.group.translateX,r=i.options.allowDragY?t.clientY-i.startY+i.group.translateY:i.group.translateY;i.transX=s,i.transY=r,i.group.attr({transform:"translate("+s+","+r+")"}),i.hadMove=!0}},storeAnnotation:function(t,n,e){if(e.annotationDraging||(t.stopPropagation(),t.preventDefault()),!w&&0===t.button||w&&1===t.button){var o=t.clientX,a=t.clientY;e.activeAnnotation=n,e.activeAnnotation.startX=o,e.activeAnnotation.startY=a,e.activeAnnotation.transX=0,e.activeAnnotation.transY=0,b(document,"mousemove",function(t){n.events.translateAnnotation(t,e)})}},releaseAnnotation:function(t,n){if(t.stopPropagation(),t.preventDefault(),!n.activeAnnotation||0===n.activeAnnotation.transX&&0===n.activeAnnotation.transY)n.activeAnnotation=null;else{var e=n.activeAnnotation,o=e.transX,a=e.transY,s=e.options,r=s.xValue,l=s.yValue,u=s.xValueEnd,p=s.yValueEnd,c=s.allowDragX,h=s.allowDragY,d=e.chart.xAxis[e.options.xAxis],x=e.chart.yAxis[e.options.yAxis],f=d.toValue(o),y=x.toValue(a);0===o&&0===a||(c&&h?e.update({xValue:i(r)?f:null,yValue:i(l)?y:null,xValueEnd:i(u)?u-r+f:null,yValueEnd:i(p)?p-l+y:null,x:i(r)?null:o,y:i(l)?null:a},!1):c?e.update({xValue:i(r)?f:null,yValue:i(l)?l:null,xValueEnd:i(u)?u-r+f:null,yValueEnd:i(p)?p:null,x:i(r)?null:o,y:i(l)?null:e.options.y},!1):h&&e.update({xValue:i(r)?r:null,yValue:i(l)?y:null,xValueEnd:i(u)?u:null,yValueEnd:i(p)?p-l+y:null,x:i(r)?null:e.options.x,y:i(l)?null:a},!1)),n.activeAnnotation=null,n.redraw(!1)}}}},y(f.prototype,{addAnnotation:function(t,n){var e,a,i,s=this,r=s.annotations.allItems;for(o(t)||(t=[t]),i=t.length,a=0;a<i;a++)e=new P(s,t[a]),r.push(e)>s.options.annotations.length&&s.options.annotations.push(t[a]),e.render(n)},redrawAnnotations:function(){for(var t,n,e=this,o=e.yAxis,a=o.length,i=e.annotations,s=i.options.buttonsOffsets,u=0;u<a;u++)if(n=o[u],t=i.clipPaths[u])t.attr({x:n.left,y:n.top,width:n.width,height:n.height});else{var p=l(e,n);i.clipPaths.push(p),i.groups.push(r(e,u,p))}v(e.annotations.allItems,function(t){t.redraw()}),v(e.annotations.buttons,function(t,n){var o=e.rangeSelector&&e.rangeSelector.inputGroup?e.rangeSelector.inputGroup.offset:0,a=e.plotWidth+e.plotLeft-30*(n+1)-o-s[0];t[0].attr({x:a})})}}),f.prototype.callbacks.push(function(t){for(var n,a,i=t.options.annotations,s=t.yAxis,p=s.length,c=[],d=[],x=0;x<p;x++)n=s[x],a=l(t,n),c.push(a),d.push(r(t,x,a));t.annotations||(t.annotations={}),t.options.annotations||(t.options.annotations=[]),t.annotations.allItems||(t.annotations.allItems=[]),t.annotations.allowZoom=!0,t.annotations.chart=t,t.annotations.groups=d,t.annotations.clipPaths=c,o(i)&&i.length>0&&t.addAnnotation(t.options.annotations),t.annotations.options=g(e(),t.options.annotationsOptions?t.options.annotationsOptions:{}),t.annotations.options.enabledButtons?(h(t),u(t)):(t.annotations.buttons=[],u(t)),b(t,"redraw",function(){t.redrawAnnotations()})}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t){if(null===this)throw new TypeError;var n=Object(this),e=n.length>>>0;if(0===e)return-1;var o=0;if(arguments.length>1&&((o=Number(arguments[1]))!==o?o=0:0!==o&&o!==1/0&&o!==-1/0&&(o=(o>0||-1)*Math.floor(Math.abs(o)))),o>=e)return-1;for(var a=o>=0?o:Math.max(e-Math.abs(o),0);a<e;a++)if(a in n&&n[a]===t)return a;return-1})});